package me.maskat.ArenaPVP;

import java.util.Collection;

import org.bukkit.GameMode;
import org.bukkit.Material;
import org.bukkit.Sound;
import org.bukkit.inventory.ItemStack;

import me.maskat.ArenaManager.ArenaPlugin.AbortArenaGameEvent;
import me.maskat.ArenaManager.ArenaPlugin.ArenaInstance;
import me.maskat.ArenaManager.ArenaPlugin.ArenaPluginManager;
import me.maskat.ArenaManager.ArenaPlugin.ArpTeam;
import me.maskat.ArenaManager.ArenaPlugin.EndArenaGameEvent;
import me.maskat.ArenaManager.ArenaPlugin.PlayerDamageInArenaEvent;
import me.maskat.ArenaManager.ArenaPlugin.PlayerDeathInArenaEvent;
import me.maskat.ArenaManager.ArenaPlugin.PlayerLeaveArenaEvent;
import me.maskat.ArenaManager.ArenaPlugin.PlayerRespawnInArenaEvent;
import me.maskat.ArenaManager.ArenaPlugin.PrepareArenaAsyncEvent;
import me.maskat.ArenaManager.ArenaPlugin.PreparePlayersToArenaEvent;
import me.maskat.ArenaManager.ArenaPlugin.StartArenaGameEvent;
import mkproject.maskat.Papi.Papi;

public class PvP_ArenaInstance implements ArenaInstance {

	@Override
	public void onPrepareArenaAsync(PrepareArenaAsyncEvent event) {
	}

	@Override
	public void onPreparePlayersToArenaEvent(PreparePlayersToArenaEvent event) {
		ArenaPluginManager.doStartGame(this, 0);
	}

	@Override
	public void onStartArenaGame(StartArenaGameEvent event) {
		event.getArena().setPlayersFreeze(false);
		event.getArena().setPlayersGodmode(false);
		event.getArena().playersPlaySound(Sound.ENTITY_BLAZE_HURT);
	}

	@Override
	public void onEndArenaGame(EndArenaGameEvent event) {
	}

	@Override
	public void onAbortArenaGameEvent(AbortArenaGameEvent event) {
	}

	@Override
	public void onPlayerDeathInArena(PlayerDeathInArenaEvent event) {
		Plugin.getPlugin().getLogger().warning("Player '"+event.getPlayer().getPlayer().getName()+"' arena: PlayerDeathInArenaEvent");
		event.getDrops().clear();
		event.setDroppedExp(0);
		
		event.playerLeaveArena();
	}

	@Override
	public void onPlayerRespawnInArena(PlayerRespawnInArenaEvent event) {
		Plugin.getPlugin().getLogger().warning("Player '"+event.getPlayer().getPlayer().getName()+"' arena: PlayerRespawnInArenaEvent");
	}

	@Override
	public void onPlayerDamageInArena(PlayerDamageInArenaEvent event) {
	}

	@Override
	public void onPlayerLeaveArena(PlayerLeaveArenaEvent event) {
		event.getPlayer().getPlayer().getInventory().clear();
		event.getPlayer().getPlayer().updateInventory();
		
		if(!event.getArena().isGameEnded()) {
			Collection<ArpTeam> teamsInsideArena = event.getArena().getTeamsInsideArena();
			
			if(teamsInsideArena.size() == 1)
				teamsInsideArena.iterator().next().doWinnerGame();
		}
	}

}
