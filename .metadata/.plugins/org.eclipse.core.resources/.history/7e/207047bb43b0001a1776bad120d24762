package me.maskat.MonsterEvent;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.entity.Creature;
import org.bukkit.entity.Entity;
import org.bukkit.entity.EntityType;
import org.bukkit.entity.Player;

import me.maskat.ArenaManager.ArenaAPI.ApiArena;
import me.maskat.ArenaManager.ArenaAPI.ApiTeam;
import me.maskat.MonsterEvent.enums.Team;
import mkproject.maskat.Papi.Papi;
import mkproject.maskat.Papi.Scheduler.PapiScheduler;

public class SchedulerTask implements PapiScheduler {
	
	private static boolean eventStarted = false;
	private static ApiArena apiArena = apiArena;
	public SchedulerTask(ApiArena apiArena)
	{
	}


	@Override
	public void runTaskThread() {
		eventStarted = true;
		Task.spawnMobsTask();
	}

	
	protected static void spawnMobsTask(ApiArena apiArena, int secoundDuration) {
		Plugin.getPlugin().getLogger().info(">>>>>>>>>>>>>>>>> spawnMobsTask(ApiArena apiArena, int secoundDuration="+secoundDuration+")");
		Bukkit.getScheduler().runTaskLaterAsynchronously(Plugin.getPlugin(), new Runnable() {
			@Override
			public void run() {
				if(apiArena.getWorld().getPlayers().size() > 0 && apiArena.getWorld().getEntities().size() < 50)
				{
					Plugin.getPlugin().getLogger().info("### SPAWN MOB:");
					EntityType entityType = allowEntityTypes.get(Papi.Function.randomInteger(0, allowEntityTypes.size()));
					Plugin.getPlugin().getLogger().info("### Random entity type: " + entityType);
					ApiTeam monstersTeam = apiArena.getTeam(Team.MONSTERS.name());
					Location loc = monstersTeam.getSpawnsLocation().get(Papi.Function.randomInteger(0, monstersTeam.getSpawnsLocation().size()));
					Plugin.getPlugin().getLogger().info("### Location: " + loc);
					Entity entity = loc.getWorld().spawnEntity(loc, entityType);
					Plugin.getPlugin().getLogger().info("### Type: " + entity.getType());
					if(entity instanceof Creature)
					{
						Plugin.getPlugin().getLogger().info("### Mob is not Creature :)");
						Player pNear = Papi.Function.getNearestPlayer(loc);
						((Creature) entity).setTarget(pNear);
						Plugin.getPlugin().getLogger().info("### Target near: " + pNear.getName());
					}
					else
						Plugin.getPlugin().getLogger().info("### Mob is not Creature !!!!!!!!!");
					entity.remove();
				}
				if(secoundDuration>0)
					spawnMobsTask(apiArena, secoundDuration-1);
				else
					eventStarted = false;
			}
		}, 20L);
	}

}
